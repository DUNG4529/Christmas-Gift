<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>3D Christmas Tree</title>
        <style>
            html,
            body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: #020205;
                font-family: 'Arial', sans-serif;
            }

            canvas {
                display: block;
            }

            .overlay-text {
                position: absolute;
                bottom: 50px;
                left: 50%;
                transform: translateX(-50%);
                color: rgba(255, 255, 255, 0.9);
                font-size: 2rem;
                font-weight: 300;
                letter-spacing: 5px;
                pointer-events: none;
                text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
                font-family: 'Brush Script MT', cursive;
                text-align: center;
            }
        </style>
    </head>

    <body>
        <div class="overlay-text">Merry Christmas & Happy New Year</div>
        <canvas id="scene"></canvas>

        <script>
            const CONFIG = {
                particleCount: 1500,
                snowCount: 200,
                particleSize: 2,
                treeWidth: 250,
                treeHeight: 500,
                spinSpeed: 0.0012,  // ĐÃ GIẢM TỪ 0.005 XUỐNG 0.0012 ĐỂ XOAY CHẬM HƠN
                colorMode: 'mixed'
            };

            const canvas = document.getElementById('scene');
            const ctx = canvas.getContext('2d');
            let width = canvas.width = window.innerWidth;
            let height = canvas.height = window.innerHeight;

            let particles = [];
            let snowParticles = [];
            let angleY = 0;

            const M3D = {
                project: (p3d, width, height) => {
                    const fov = 300;
                    const scale = fov / (fov + p3d.z);
                    return {
                        x: p3d.x * scale + width / 2,
                        y: -p3d.y * scale + height / 2,
                        scale: scale
                    };
                },

                rotateY: (p3d, angle) => {
                    const cos = Math.cos(angle);
                    const sin = Math.sin(angle);
                    return {
                        x: p3d.x * cos - p3d.z * sin,
                        y: p3d.y,
                        z: p3d.z * cos + p3d.x * sin,
                        color: p3d.color,
                        origY: p3d.origY
                    };
                }
            };

            class Particle {
                constructor(x, y, z) {
                    this.x = x;
                    this.y = y;
                    this.z = z;
                    this.origY = y;
                    this.color = this.generateColor();
                    this.alpha = Math.random();
                    this.blinkOffset = Math.random() * Math.PI * 2;
                }

                generateColor() {
                    const rand = Math.random();
                    if (CONFIG.colorMode === 'green') {
                        return `50, ${150 + Math.random() * 105}, 50`;
                    }
                    if (rand > 0.90) return `255, 50, 50`;
                    if (rand > 0.80) return `255, 255, 50`;
                    if (rand > 0.75) return `255, 255, 255`;
                    return `50, ${150 + Math.random() * 105}, 50`;
                }

                update(time) {
                    this.alpha = 0.5 + 0.5 * Math.sin(time * 2 + this.blinkOffset);
                }
            }

            class Snow {
                constructor() {
                    this.reset();
                }

                reset() {
                    this.x = (Math.random() - 0.5) * width * 2;
                    this.y = -height / 2 - Math.random() * height;
                    this.z = (Math.random() - 0.5) * 500;
                    this.speed = 1 + Math.random() * 2;
                    this.radius = 1 + Math.random() * 2;
                }

                update() {
                    this.y += this.speed;
                    if (this.y > height / 2 + 100) {
                        this.reset();
                    }
                }

                draw(ctx) {
                    const p3d = { x: this.x, y: this.y, z: this.z };
                    const rotated = M3D.rotateY(p3d, angleY);
                    const p2d = M3D.project(rotated, width, height);

                    if (p2d.scale > 0) {
                        ctx.fillStyle = `rgba(255, 255, 255, ${Math.min(1, p2d.scale)})`;
                        ctx.beginPath();
                        ctx.arc(p2d.x, p2d.y, this.radius * p2d.scale, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }

            function initTree() {
                particles = [];

                // Tạo thân cây
                for (let i = 0; i < CONFIG.particleCount; i++) {
                    const p = i / CONFIG.particleCount;
                    const y = CONFIG.treeHeight / 2 - p * CONFIG.treeHeight;
                    const radius = p * CONFIG.treeWidth * 0.8;
                    const angle = i * 0.15;
                    const x = Math.cos(angle) * radius;
                    const z = Math.sin(angle) * radius;
                    particles.push(new Particle(x, y, z));
                }

                // Tạo ngôi sao trên đỉnh
                for (let i = 0; i < 100; i++) {
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.acos(2 * Math.random() - 1);
                    const r = Math.random() * 15;
                    const x = r * Math.sin(phi) * Math.cos(theta);
                    const y = -CONFIG.treeHeight / 2 - 15 + r * Math.sin(phi) * Math.sin(theta);
                    const z = r * Math.cos(phi);
                    const star = new Particle(x, y, z);
                    star.color = `255, 215, 0`;
                    particles.push(star);
                }
            }

            function initSnow() {
                snowParticles = [];
                for (let i = 0; i < CONFIG.snowCount; i++) {
                    snowParticles.push(new Snow());
                }
            }

            function animate() {
                ctx.clearRect(0, 0, width, height);

                // Cập nhật góc xoay tự động với tốc độ chậm hơn
                angleY += CONFIG.spinSpeed;
                const time = Date.now() * 0.001;

                // Vẽ tuyết
                snowParticles.forEach(snow => {
                    snow.update();
                    snow.draw(ctx);
                });

                // Xử lý và vẽ cây
                let renderList = [];
                particles.forEach(p => {
                    p.update(time);
                    const rotated = M3D.rotateY(p, angleY);
                    const p2d = M3D.project(rotated, width, height);

                    if (p2d.scale > 0) {
                        renderList.push({
                            x: p2d.x,
                            y: p2d.y,
                            scale: p2d.scale,
                            z: rotated.z,
                            color: rotated.color,
                            alpha: p.alpha
                        });
                    }
                });

                renderList.sort((a, b) => b.z - a.z);

                renderList.forEach(p => {
                    ctx.beginPath();
                    const alpha = p.alpha * p.scale;
                    ctx.fillStyle = `rgba(${p.color}, ${alpha})`;
                    ctx.arc(p.x, p.y, CONFIG.particleSize * p.scale, 0, Math.PI * 2);
                    ctx.fill();
                });

                requestAnimationFrame(animate);
            }

            window.addEventListener('resize', () => {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
                initSnow();
            });

            initTree();
            initSnow();
            animate();
        </script>
    </body>

</html>