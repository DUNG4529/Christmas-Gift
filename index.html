<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MÃ³n quÃ  GiÃ¡ng Sinh</title>
    <meta name="description" content="Má»™t mÃ³n quÃ  GiÃ¡ng Sinh nhá» xinh dÃ nh riÃªng cho em" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="effects/button.css" />
    
  </head>
  <body>
    <canvas id="star-canvas" aria-hidden="true"></canvas>
    <canvas id="snow-canvas" aria-hidden="true"></canvas>

    <header class="site-header">
      <div class="wrap">
        <button id="brand-home-global" class="brand btn btn-secondary" style="background: transparent; border: none; padding: 0;">ğŸ„ Christmas Gift</button>
        <nav>
          <a href="#festive">Trang trÃ­ cÃ¢y</a>
          <a href="#gallery">Kho áº£nh</a>
          <button id="open-gift" class="btn btn-primary">Má»Ÿ mÃ³n quÃ </button>
        </nav>
      </div>
    </header>

    <main class="hero">
      <div class="wrap">
        <h1>
          Gá»­i <span id="recipient-name">Em</span>,
        </h1>
        <p class="lead">
          MÃ¹a GiÃ¡ng Sinh nÃ y, anh cÃ³ má»™t mÃ³n quÃ  nhá» muá»‘n dÃ nh cho em â€”
          má»™t trang web nho nhá» Ä‘Æ°á»£c anh tá»± tay lÃ m, chá»©a nhá»¯ng Ä‘iá»u dá»… thÆ°Æ¡ng vÃ  nhá»¯ng ká»· niá»‡m cá»§a chÃºng mÃ¬nh.
        </p>
        <div class="actions">
          <button id="open-gift-hero" class="btn btn-primary">Má»Ÿ mÃ³n quÃ  ğŸ</button>
          <a href="#memories" class="btn btn-secondary">Xem ká»· niá»‡m âœ¨</a>
        </div>
        <p class="signature">â€” tá»« <span id="sender-name">Anh</span> â€”</p>
      </div>
    </main>

    <section id="festive" class="festive">
      <div class="wrap">
        <h2>Trang trÃ­ cÃ¢y thÃ´ng ğŸ„</h2>
        <p class="lead">Cháº¡m vÃ o cÃ¡c quáº£ chÃ¢u Ä‘á»ƒ nháº­n lá»i chÃºc ngáº«u nhiÃªn âœ¨</p>
        <div class="tree-stage">
          <div class="tree" aria-label="CÃ¢y thÃ´ng Noel">
            <div class="triangle t1"></div>
            <div class="triangle t2"></div>
            <div class="triangle t3"></div>
            <div class="trunk"></div>
            <!-- Ornaments -->
            <button class="ornament" style="left: 50%; top: 28%;" aria-label="Quáº£ chÃ¢u"></button>
            <button class="ornament" style="left: 35%; top: 40%;" aria-label="Quáº£ chÃ¢u"></button>
            <button class="ornament" style="left: 63%; top: 42%;" aria-label="Quáº£ chÃ¢u"></button>
            <button class="ornament" style="left: 28%; top: 56%;" aria-label="Quáº£ chÃ¢u"></button>
            <button class="ornament" style="left: 72%; top: 58%;" aria-label="Quáº£ chÃ¢u"></button>
            <button class="ornament" style="left: 45%; top: 66%;" aria-label="Quáº£ chÃ¢u"></button>
          </div>
        </div>
        <div class="actions">
          <button id="shake-snow" class="btn btn--snow btn--hat">Láº¯c tuyáº¿t â„ï¸</button>
          <button id="fireworks" class="btn btn--fireworks btn--hat">PhÃ¡o hoa ğŸ†</button>
        </div>
      </div>
    </section>


    <section id="gallery" class="gallery">
      <div class="wrap">
        <h2>Kho áº£nh cá»§a chÃºng mÃ¬nh</h2>
        <div class="gallery-view">
          <img id="gallery-image" alt="Ká»· niá»‡m" />
          <div id="gallery-caption" class="caption"></div>
        </div>
        <div class="gallery-controls">
          <button id="gallery-prev" class="btn btn-secondary">âŸ¨ TrÆ°á»›c</button>
          <button id="gallery-next" class="btn btn-secondary">Sau âŸ©</button>
        </div>
      </div>
    </section>

    <!-- Gift SPA view (single global header kept) -->
    <section id="gift-view" class="gift-page" hidden>
      <canvas id="snow-canvas-gift" aria-hidden="true"></canvas>
      <main class="gift-main">
        <div class="wrap">
          <h1>MÃ³n quÃ  dÃ nh cho <span id="recipient-name-gift">Em</span></h1>
          <p class="hint">Cháº¡m vÃ o phong bÃ¬ Ä‘á»ƒ má»Ÿ ğŸ’Œ</p>

          <div id="envelope" class="envelope" role="button" aria-label="Má»Ÿ thÆ°" tabindex="0">
            <div class="flap"></div>
            <div class="letter">
              <div class="letter-content" id="letter-content"></div>
            </div>
            <div class="seal">ğŸ’–</div>
          </div>

          <div class="gift-actions">
            <button id="shake-snow-gift" class="btn btn--snow btn--hat">Láº¯c tuyáº¿t â„ï¸</button>
            <button id="fireworks-gift" class="btn btn--fireworks btn--hat">PhÃ¡o hoa ğŸ†</button>
            <button id="replay" class="btn btn-secondary">Xem láº¡i hiá»‡u á»©ng</button>
          </div>
        </div>
      </main>
      <div id="hearts-container" aria-hidden="true"></div>
      <footer class="site-footer">
        <div class="wrap">
          <small>Merry Christmas â€¢ With love</small>
        </div>
      </footer>
    </section>

    <footer class="site-footer">
      <div class="wrap">
        <small>ChÃºc GiÃ¡ng Sinh an lÃ nh vÃ  áº¥m Ã¡p ğŸ’šâ¤ï¸</small>
      </div>
    </footer>

    <!-- Garland lights & Santa fly-by -->
    <ul class="garland" aria-hidden="true">
      <li></li><li></li><li></li><li></li><li></li>
      <li></li><li></li><li></li><li></li><li></li>
    </ul>
    <div id="santa" aria-hidden="true">ğŸ…ğŸ›·</div>

    <div id="music-bar" class="music-bar" aria-live="polite">
      <input id="music-volume" type="range" min="0" max="1" step="0.05" value="0.6" aria-label="Ã‚m lÆ°á»£ng nháº¡c" />
    </div>
    <!-- Curtain wipe for scene transitions -->
    <div class="curtain" id="curtain" aria-hidden="true"></div>

    <script src="config.js"></script>
    <script src="effects/snow-config.js"></script>
    <script src="script.js"></script>
    <!-- Interactive firework overlay (on-demand) -->
    <script src="firework/script_firesork.js"></script>
    
    <script>
      // Simple SPA toggling so audio persists on the same page
      document.addEventListener('DOMContentLoaded', () => {
        const giftView = document.getElementById('gift-view');
        const curtain = document.getElementById('curtain');
        const sections = [document.querySelector('.hero'), document.getElementById('festive'), document.getElementById('stage3d'), document.getElementById('gallery'), document.querySelector('.site-footer')];
        // Helper to apply enter/exit transitions
        function transitionOut(nodes){
          // Show curtain first for a classy wipe
          if (curtain) {
            curtain.classList.remove('hide');
            curtain.classList.add('show');
          }
          nodes.forEach(n => {
            if (!n || n.hidden) return;
            n.classList.remove('view-enter','view-enter-active');
            n.classList.add('view-exit');
            requestAnimationFrame(() => {
              n.classList.add('view-exit-active');
              setTimeout(() => { n.hidden = true; n.classList.remove('view-exit','view-exit-active'); }, 620);
            });
          });
        }
        function transitionIn(node){
          node.hidden = false;
          node.classList.remove('view-exit','view-exit-active');
          node.classList.add('view-enter');
          requestAnimationFrame(() => {
            node.classList.add('view-enter-active');
            setTimeout(() => {
              node.classList.remove('view-enter','view-enter-active');
              // Hide curtain after content has entered
              if (curtain) {
                curtain.classList.remove('show');
                curtain.classList.add('hide');
                // remove classes once animation done
                setTimeout(() => { curtain.classList.remove('hide'); }, 720);
              }
            }, 740);
          });
        }
        function showGift(){
          transitionOut(sections);
          transitionIn(giftView);
          // Switch header action to "Trá»Ÿ vá» trang chá»§"
          const navBackBtn = document.getElementById('open-gift');
          if (navBackBtn) {
            navBackBtn.textContent = 'Trá»Ÿ vá» trang chá»§';
            navBackBtn.className = 'btn btn-secondary';
            // Remove previous listeners by cloning
            const clone = navBackBtn.cloneNode(true);
            navBackBtn.parentNode.replaceChild(clone, navBackBtn);
            clone.addEventListener('click', showHome);
          }
          // Initialize gift interactions
          const envelope = document.getElementById('envelope');
          const letterContent = document.getElementById('letter-content');
          const letterEl = envelope.querySelector('.letter');
          const replayBtn = document.getElementById('replay');
          const recipientEl = document.getElementById('recipient-name-gift');
          try {
            recipientEl.textContent = (window.GIFT_CONFIG?.recipientName) || 'Em';
            letterContent.innerHTML = (window.GIFT_CONFIG?.specialMessage || 'Gá»­i em, chÃºc em má»™t mÃ¹a GiÃ¡ng Sinh tháº­t an lÃ nh vÃ  áº¥m Ã¡p!');
            // Inject date chip (VN locale)
            const now = new Date();
            const day = now.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });
            const chip = document.createElement('div');
            chip.className = 'date-chip';
            chip.textContent = `GiÃ¡ng Sinh ${now.getFullYear()} â€¢ ${day}`;
            // avoid duplicates
            const oldChip = letterContent.querySelector('.date-chip');
            if (oldChip) oldChip.remove();
            letterContent.prepend(chip);
            // Add a small festive sticker to the letter corner
            const oldSticker = letterEl.querySelector('.sticker');
            if (oldSticker) oldSticker.remove();
            const sticker = document.createElement('div');
            sticker.className = 'sticker';
            sticker.textContent = 'ğŸ•¯ï¸';
            letterEl.appendChild(sticker);
          } catch (e) {}
          const open = () => { 
            // Open the envelope; the letter will zoom to center
            envelope.classList.add('open');
            giftView.classList.add('opening');
            window.startHeartConfetti && window.startHeartConfetti();
            setTimeout(()=> giftView.classList.remove('opening'), 1400);
          };
          const closeLetter = () => {
            if (envelope.classList.contains('open')) {
              envelope.classList.remove('open');
            }
          };
          envelope.addEventListener('click', open);
          envelope.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); open(); } });
          replayBtn.addEventListener('click', () => {
            envelope.classList.remove('open');
            void envelope.offsetWidth; // reflow
            window.startHeartConfetti && window.startHeartConfetti();
          });
          // Click outside letter to close back into envelope
          giftView.addEventListener('click', (e) => {
            const letterEl = document.querySelector('#letter-content')?.parentElement;
            const insideLetter = letterEl && (letterEl.contains(e.target));
            const insideEnvelope = envelope.contains(e.target);
            if (!insideLetter && !insideEnvelope) closeLetter();
          });
          // ESC to close
          document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeLetter(); }, { once: true });
        }
        function showHome(){
          transitionOut([giftView]);
          sections.forEach(s => s && transitionIn(s));
          // Restore header action to "Má»Ÿ mÃ³n quÃ "
          const navOpenBtn = document.getElementById('open-gift');
          if (navOpenBtn) {
            navOpenBtn.textContent = 'Má»Ÿ mÃ³n quÃ ';
            navOpenBtn.className = 'btn btn-primary';
            const clone = navOpenBtn.cloneNode(true);
            navOpenBtn.parentNode.replaceChild(clone, navOpenBtn);
            clone.addEventListener('click', showGift);
          }
        }
        const openBtns = [document.getElementById('open-gift'), document.getElementById('open-gift-hero')];
        openBtns.forEach(b => b && b.addEventListener('click', showGift));
        document.getElementById('brand-home-global')?.addEventListener('click', showHome);
      });
    </script>
  </body>
</html>
